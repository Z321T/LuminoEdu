你想要的项目结构是以“**功能模块驱动 + 角色分离设计**”为导向的，这是**复杂系统**中非常推荐的一种架构。下面我为你设计一个支持“教师 / 学生 / 管理员”三类用户、并具有“登录、作业批改、成绩查询”等功能的**模块化、可维护、可拓展的 FastAPI 项目结构**，并详细解释该如何组织代码。



------





## **🧱 项目结构设计（功能模块 + 用户类型分离）**



```
server/
├── app/
│   ├── main.py                 # FastAPI 入口 + 路由注册
│   ├── config.py               # 环境变量配置
│   ├── database.py             # 数据库连接
│   ├── core/                   # 通用工具和基础服务
│   │   ├── auth.py             # JWT 验证与生成
│   │   ├── security.py         # 密码哈希处理
│   │   ├── dependencies.py     # 通用依赖（如权限判断）
│   │   └── exceptions.py       # 自定义异常
│
│   ├── models/                 # 数据库模型（角色 + 通用表）
│   │   ├── user_common.py      # 所有用户通用字段（抽象基类）
│   │   ├── student.py          # 学生模型
│   │   ├── teacher.py          # 教师模型
│   │   ├── admin.py            # 管理员模型
│   │   └── homework.py         # 作业表（公共）
│
│   ├── schemas/                # 请求响应模型
│   │   ├── student/            # 学生相关 schema
│   │   ├── teacher/            # 教师相关 schema
│   │   ├── admin/              # 管理员相关 schema
│   │   ├── auth.py             # 登录 / 注册结构体
│   │   └── homework.py         # 作业相关结构体
│
│   ├── crud/                   # 数据库操作
│   │   ├── student/            # 学生相关操作
│   │   ├── teacher/            # 教师相关操作
│   │   ├── admin/              # 管理员相关操作
│   │   └── homework.py         # 公共的作业操作
│
│   ├── services/               # 业务逻辑处理（服务层，非必需）
│   │   ├── grading.py          # 作业批改逻辑
│   │   └── login.py            # 登录逻辑（多角色统一登录）
│
│   ├── routers/                # 路由模块（按功能划分 + 角色细分）
│   │   ├── auth.py             # 登录 / 注册接口
│   │   ├── student/            # 学生接口集合
│   │   │   └── homework.py     # 学生提交作业
│   │   ├── teacher/            # 教师接口集合
│   │   │   └── grading.py      # 教师批改作业
│   │   ├── admin/              # 管理员接口集合
│   │   │   └── user_mgmt.py    # 管理员管理用户
│
│   └── utils/                  # 工具函数
│       └── file.py             # 作业上传/下载
│
├── alembic/                    # 数据迁移
├── tests/                      # 测试模块
├── requirements.txt
└── Dockerfile
```





------





## **✅ FastAPI 项目结构模块职责对照表**



| **文件/目录** | **模块类型** | **职责描述**                                                 |
| ------------- | ------------ | ------------------------------------------------------------ |
| models/       | 数据模型层   | 定义数据库 ORM 模型，三类用户（学生/教师/管理员）分离设计，必要时使用抽象父类提取共有字段。 |
| schemas/      | 数据结构层   | 使用 Pydantic 定义请求体和响应体，**按角色子文件夹划分**，区分不同角色使用的数据结构。 |
| crud/         | 数据访问层   | 封装对数据库的增删改查操作，按角色和模块分拆，防止代码耦合；可抽象出公共操作方法。 |
| routers/      | 接口路由层   | 定义 API 接口，按“功能 + 角色”组织，如 /teacher/grading、/student/homework。 |
| services/     | 业务逻辑层   | 处理复杂的业务流程逻辑，**解耦接口与底层数据逻辑**，如批改流程、统计处理等。 |
| core/         | 核心控制模块 | 放置权限控制、身份认证、异常处理等通用逻辑，例如 OAuth2、JWT、统一异常类。 |
| utils/        | 工具函数模块 | 封装独立的通用工具函数，例如 Excel 导出、PDF 报表生成、加密工具、日志工具等。 |





------





## **🔐 权限控制建议**





你可以在 core/dependencies.py 中实现以下权限控制：

```
from fastapi import Depends, HTTPException
from .auth import get_current_user

def role_required(role: str):
    def checker(user=Depends(get_current_user)):
        if user.role != role:
            raise HTTPException(status_code=403, detail="权限不足")
        return user
    return checker
```

使用时：

```
@router.post("/correct")
def correct_homework(..., current_user=Depends(role_required("teacher"))):
    ...
```





------





## **✨ 多角色登录统一处理建议**





你可以统一一个登录接口 /auth/login，根据 username 查询是哪种用户并进行验证。例如：

```
def authenticate_user(username: str, password: str):
    for user_type in ["student", "teacher", "admin"]:
        user = get_user_by_type(user_type, username)
        if user and verify_password(password, user.hashed_password):
            return user
    return None
```





------





## **✅ 小结：这种结构适合的特点**



| **特点** | **描述**                                                |
| -------- | ------------------------------------------------------- |
| 模块清晰 | 功能维度清晰：用户管理、作业处理、成绩管理等分开开发    |
| 角色分离 | 教师 / 学生 / 管理员 的接口、数据模型、权限控制互不干扰 |
| 易于扩展 | 后续加新角色或功能，只需在相应模块新增                  |
| 易于协作 | 多人开发时，可按模块分工，互不影响                      |





------



如果你需要我为你**写一个简化版的项目骨架代码（含认证、路由、学生提交与教师批改功能）**，我可以立刻为你生成一份最小可运行的项目模板。你是否希望我继续？